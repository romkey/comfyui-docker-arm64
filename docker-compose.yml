services:
  comfyui:
    image: ghcr.io/lecode-official/comfyui-docker:latest
    container_name: comfyui
    restart: unless-stopped
    environment:
      USER_ID: "${UID:-1000}"
      GROUP_ID: "${GID:-1000}"
    ports:
      - "8188:8188"
    volumes:
      - ${HOME}/.comfyui/models:/opt/comfyui/models:rw
      - ${HOME}/.comfyui/custom-nodes:/opt/comfyui/custom_nodes:rw
      - ${HOME}/.comfyui/output:/opt/comfyui/output:rw
    # Optional: pass extra ComfyUI CLI args (example shown commented)
    # command: ["--enable-cors-header", "*"]
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

# Usage:
# 1. (Optional) Create a .env file alongside this compose file with:
#    UID=$(id -u)
#    GID=$(id -g)
# 2. Ensure directories exist:
#    mkdir -p "$HOME/.comfyui"/{models,custom-nodes,output}
# 3. Start: docker compose up -d
# 4. Update image later: docker compose pull && docker compose up -d
# 5. View logs: docker compose logs -f
